<Query Kind="Program">
  <Reference Relative="..\bin\Debug\net5.0\TestApp.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\TestApp.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\TestApp.deps.json">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\TestApp.deps.json</Reference>
  <Reference Relative="..\bin\Debug\net5.0\TestApp.runtimeconfig.json">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\TestApp.runtimeconfig.json</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Jobs.Abstractions.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Jobs.Abstractions.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Jobs.Hangfire.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Jobs.Hangfire.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Autofac.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Autofac.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\EntityFramework.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\EntityFramework.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\EntityFramework.SqlServer.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\EntityFramework.SqlServer.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Microsoft.CodeAnalysis.CSharp.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Microsoft.CodeAnalysis.CSharp.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Microsoft.CodeAnalysis.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Microsoft.CodeAnalysis.dll</Reference>
  <Reference>..\Microsoft.Win32.SystemEvents.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Newtonsoft.Json.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Newtonsoft.Json.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\NLog.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\NLog.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Oracle.ManagedDataAccess.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Oracle.ManagedDataAccess.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Compiler.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Compiler.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Compiler.Interfaces.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Compiler.Interfaces.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Configuration.Autofac.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Configuration.Autofac.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.DatabaseGenerator.DefaultConcepts.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.DatabaseGenerator.DefaultConcepts.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.DatabaseGenerator.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.DatabaseGenerator.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.DatabaseGenerator.Interfaces.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.DatabaseGenerator.Interfaces.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Deployment.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Deployment.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Deployment.Interfaces.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Deployment.Interfaces.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Dom.DefaultConcepts.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Dom.DefaultConcepts.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Dom.DefaultConcepts.Interfaces.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Dom.DefaultConcepts.Interfaces.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Dom.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Dom.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Dom.Interfaces.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Dom.Interfaces.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Dsl.DefaultConcepts.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Dsl.DefaultConcepts.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Dsl.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Dsl.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Dsl.Interfaces.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Dsl.Interfaces.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Dsl.Parser.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Dsl.Parser.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Extensibility.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Extensibility.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Extensibility.Interfaces.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Extensibility.Interfaces.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Host.Net.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Host.Net.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Logging.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Logging.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Logging.Interfaces.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Logging.Interfaces.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Persistence.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Persistence.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Persistence.Interfaces.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Persistence.Interfaces.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Processing.DefaultCommands.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Processing.DefaultCommands.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Processing.DefaultCommands.Interfaces.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Processing.DefaultCommands.Interfaces.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Processing.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Processing.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Processing.Interfaces.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Processing.Interfaces.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Security.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Security.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Security.Interfaces.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Security.Interfaces.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Utilities.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Utilities.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.Utilities.Interfaces.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.Utilities.Interfaces.dll</Reference>
  <Reference Relative="..\bin\Debug\net5.0\Rhetos.XmlSerialization.dll">C:\My Projects\RhetosPackages\Jobs\test\TestApp\bin\Debug\net5.0\Rhetos.XmlSerialization.dll</Reference>
  <Namespace>Autofac</Namespace>
  <Namespace>Oracle.ManagedDataAccess.Client</Namespace>
  <Namespace>Rhetos</Namespace>
  <Namespace>Rhetos.Configuration.Autofac</Namespace>
  <Namespace>Rhetos.Dom</Namespace>
  <Namespace>Rhetos.Dom.DefaultConcepts</Namespace>
  <Namespace>Rhetos.Dsl</Namespace>
  <Namespace>Rhetos.Dsl.DefaultConcepts</Namespace>
  <Namespace>Rhetos.Logging</Namespace>
  <Namespace>Rhetos.Persistence</Namespace>
  <Namespace>Rhetos.Security</Namespace>
  <Namespace>Rhetos.Utilities</Namespace>
  <Namespace>System.Data.Entity</Namespace>
  <Namespace>System.DirectoryServices</Namespace>
  <Namespace>System.Runtime.Serialization.Json</Namespace>
  <Namespace>System.Xml.Serialization</Namespace>
</Query>

void Main()
{
    ConsoleLogger.MinLevel = EventType.Info; // Use EventType.Trace for more detailed log.
    string rhetosHostAssemblyPath = Path.Combine(Path.GetDirectoryName(Util.CurrentQueryPath), @"..\bin\debug\net5.0\TestApp.dll");
    using (var scope = LinqPadRhetosHost.CreateScope(rhetosHostAssemblyPath))
    {
        var context = scope.Resolve<Common.ExecutionContext>();
        var repository = context.Repository;

        // Query data from the `Common.Claim` table:
        
        var claims = repository.Common.Claim.Query()
            .Where(c => c.ClaimResource.StartsWith("Common.") && c.ClaimRight == "New")
            .ToSimple(); // Removes ORM navigation properties from the loaded objects.
            
        claims.ToString().Dump("Common.Claims SQL query");
        claims.Dump("Common.Claims items");
        
        // Add and remove a `Common.Principal`:
        
        var testUser = new Common.Principal { Name = "Test123", ID = Guid.NewGuid() };
        repository.Common.Principal.Insert(new[] { testUser });
        repository.Common.Principal.Delete(new[] { testUser });
        
        // Print logged events for the `Common.Principal`:
        
        repository.Common.LogReader.Query()
            .Where(log => log.TableName == "Common.Principal" && log.ItemId == testUser.ID)
            .ToList()
            .Dump("Common.Principal log");
            
        Console.WriteLine("Done.");
        
        //scope.CommitAndClose(); // Database transaction is rolled back by default.
    }
}
